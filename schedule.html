<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Schedule</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body { font-family: sans-serif; background-color: #f9f9f9; margin: 0; padding: 1rem; }
    .collapsible { max-width: 600px; margin: 1rem auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; }
    .collapsible header { background: #007bff; color: #fff; padding: 0.75rem 1rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
    .collapsible header h2 { margin: 0; font-size: 1.25rem; }
    .collapsible .content { padding: 1rem; display: none; }
    .collapsible.open .content { display: block; }
    h3 { margin-top: 1rem; }
    .exercise-list label { display: block; margin: 0.25rem 0; }
    #customAdd { display: flex; margin: 1rem 0; }
    #customAdd input { flex: 1; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; }
    #customAdd button { margin-left: 0.5rem; padding: 0.5rem 1rem; background: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    #customAdd button:hover { background: #0056b3; }
    button[type="submit"] { display: block; margin: 1.5rem auto 0; padding: 0.75rem 2rem; font-size: 1rem; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button[type="submit"]:hover { background-color: #0056b3; }
  </style>
</head>
<body>
  <section class="collapsible" id="librarySection">
    <header onclick="toggleSection('librarySection')">
      <h2>Manage Your Exercises</h2>
      <span id="libraryToggle">+</span>
    </header>
    <div class="content">
      <div class="category-group" data-category="bodyweight">
        <h3>Bodyweight</h3>
        <div id="lib-bodyweight" class="exercise-list"></div>
      </div>
      <div class="category-group" data-category="cardio">
        <h3>Cardio</h3>
        <div id="lib-cardio" class="exercise-list"></div>
      </div>
      <div class="category-group" data-category="dumbbell">
        <h3>Dumbbell</h3>
        <div id="lib-dumbbell" class="exercise-list"></div>
      </div>
      <div class="category-group" data-category="kettlebell">
        <h3>Kettlebell</h3>
        <div id="lib-kettlebell" class="exercise-list"></div>
      </div>
      <div class="category-group" data-category="barbell">
        <h3>Barbell</h3>
        <div id="lib-barbell" class="exercise-list"></div>
      </div>
      <div id="customAdd">
        <input type="text" id="newExerciseName" placeholder="Add a custom exercise" />
        <button type="button" onclick="addCustomExercise()">Add</button>
      </div>
    </div>
  </section>

  <section class="collapsible open" id="scheduleSection">
    <header onclick="toggleSection('scheduleSection')">
      <h2>Set Workout Schedule</h2>
      <span id="scheduleToggle">-</span>
    </header>
    <div class="content">
      <form id="scheduleForm" onchange="toggleDays()">
        <label><input type="radio" name="scheduleType" value="daily" checked /> Daily</label>
        <label><input type="radio" name="scheduleType" value="two-day" /> Two-Day Split</label>

        <div id="day1Options">
          <h3>Day 1</h3>
          <div class="exercise-list" data-day="1"></div>
        </div>
        <div id="day2Options">
          <h3>Day 2</h3>
          <div class="exercise-list" data-day="2"></div>
        </div>

        <button type="submit">Save</button>
      </form>
    </div>
  </section>

  <script>
    const defaultsByCategory = {
      bodyweight: ["pushups","pullups","squats","toeToBar"],
      cardio: ["running","jumpRope","burpees"],
      dumbbell: ["dumbbellRow","dumbbellPress"],
      kettlebell: ["kettlebellSwing","gobletSquat"],
      barbell: ["barbellSquat","deadlift","benchPress"]
    };

    let masterExercises = JSON.parse(localStorage.getItem("masterExercises") || "[]");
    if (!masterExercises.length) {
      masterExercises = [...defaultsByCategory.bodyweight];
      localStorage.setItem("masterExercises", JSON.stringify(masterExercises));
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1).replace(/([A-Z])/g, ' $1');
    }

    function renderLibrary() {
      Object.entries(defaultsByCategory).forEach(([cat, list]) => {
        const container = document.getElementById(`lib-${cat}`);
        container.innerHTML = '';
        list.forEach(ex => {
          const checked = masterExercises.includes(ex) ? "checked" : "";
          container.insertAdjacentHTML('beforeend',
            `<label><input type="checkbox" name="masterEx" value="${ex}" ${checked}/> ${capitalize(ex)}</label>`
          );
        });
        container.querySelectorAll('input[name="masterEx"]').forEach(cb => {
          cb.onchange = () => {
            masterExercises = Array.from(document.querySelectorAll('input[name="masterEx"]:checked'))
              .map(e => e.value);
            localStorage.setItem("masterExercises", JSON.stringify(masterExercises));
            buildScheduleLists();
          };
        });
      });
    }

    function addCustomExercise() {
      const name = document.getElementById("newExerciseName").value.trim();
      if (!name) return;
      const id = name.replace(/\s+/g, "").toLowerCase();
      if (!masterExercises.includes(id)) {
        masterExercises.push(id);
        localStorage.setItem("masterExercises", JSON.stringify(masterExercises));
        renderLibrary();
      }
      document.getElementById("newExerciseName").value = "";
    }

    function buildScheduleLists() {
      document.querySelectorAll(".exercise-list[data-day]").forEach(div => {
        div.innerHTML = "";
        const day = div.dataset.day;
        masterExercises.forEach(ex => {
          div.insertAdjacentHTML('beforeend',
            `<label><input type="checkbox" name="day${day}" value="${ex}" /> ${capitalize(ex)}</label>`
          );
        });
      });
    }

    function toggleDays() {
      const scheduleType = document.querySelector('input[name="scheduleType"]:checked').value;
      document.getElementById('day2Options').style.display = (scheduleType === 'two-day') ? 'block' : 'none';
    }

    function toggleSection(id) {
      const sec = document.getElementById(id);
      const open = sec.classList.toggle('open');
      sec.querySelector('header span').textContent = open ? '-' : '+';
    }

    document.getElementById("scheduleForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const form = new FormData(this);
      const scheduleType = form.get("scheduleType");
      const schedule = { type: scheduleType, day1: [], day2: [], config: {} };
      masterExercises.forEach(ex => {
        [1,2].forEach(day => {
          if (form.getAll(`day${day}`).includes(ex)) {
            schedule[`day${day}`].push(ex);
          }
        });
      });
      localStorage.setItem("workoutSchedule", JSON.stringify(schedule));
      alert("Schedule saved!");
      window.location.href = "index.html";
    });

    // init
    renderLibrary();
    buildScheduleLists();
    toggleDays();
  </script>
</body>
</html>
