<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Schedule</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    .mode-select, .weekday-list, #weekdayPanels { max-width: 600px; margin: auto; }
    .weekday-list { display: flex; justify-content: space-between; flex-wrap: wrap; padding: 1rem 0; }
    .weekday-list label { width: 30%; }
    .day-panel { background: #eef2f5; margin: 1rem auto; padding: 1rem; border-radius: 8px; max-width: 600px; }
    .exercise-config { margin-left: 1rem; display: none; }
  </style>
</head>
<body>
  <section class="mode-select">
    <h2>Pick Schedule Mode</h2>
    <label><input type="radio" name="mode" value="daily" checked/> Daily</label>
    <label><input type="radio" name="mode" value="two-day"/> Two-Day Split</label>
    <label><input type="radio" name="mode" value="manual"/> Manual</label>
  </section>

  <section class="weekday-list" id="weekdayList">
    <!-- Weekday checkboxes -->
  </section>

  <div id="weekdayPanels">
    <!-- Panels for each selected day -->
  </div>

  <div style="text-align:center;"><button id="saveBtn">Save Schedule</button></div>

  <script>
    const days = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'];
    const defaults = JSON.parse(localStorage.getItem('masterExercises')||'[]');
    const exercises = defaults.length ? defaults : ['pushups','pullups','squats','toeToBar'];

    function capitalize(s){return s.charAt(0).toUpperCase() + s.slice(1);}

    function renderWeekdayList(){
      const wl = document.getElementById('weekdayList');
      wl.innerHTML = '';
      days.forEach((day, i) => {
        wl.insertAdjacentHTML('beforeend',
          `<label><input type="checkbox" name="weekday" value="${i}"/> ${capitalize(day)}</label>`
        );
      });
      document.querySelectorAll('input[name="weekday"]').forEach(cb => cb.addEventListener('change', buildPanels));
    }

    function applyMode(){
      const mode = document.querySelector('input[name="mode"]:checked').value;
      document.querySelectorAll('input[name="weekday"]').forEach((cb, i) => {
        if(mode === 'daily') cb.checked = true;
        else if(mode === 'two-day') cb.checked = (i % 2 === 0);
        else cb.checked = false;
      });
      buildPanels();
    }

    function buildPanels(){
      const container = document.getElementById('weekdayPanels');
      container.innerHTML = '';
      document.querySelectorAll('input[name="weekday"]:checked').forEach(cb => {
        const dayIdx = cb.value;
        const panel = document.createElement('div');
        panel.className = 'day-panel';
        panel.innerHTML = `<h3>${capitalize(days[dayIdx])}</h3>`;
        const listDiv = document.createElement('div');
        exercises.forEach(ex => {
          const exId = `${ex}_${dayIdx}`;
          listDiv.insertAdjacentHTML('beforeend',
            `<label><input type="checkbox" name="day_${dayIdx}" value="${ex}" onchange="toggleConfig('${exId}', this)"/> ${capitalize(ex)}</label>
            <div id="${exId}" class="exercise-config">
              Sets: <input type="number" name="${ex}_${dayIdx}_sets" min="1" value="3"/>
              Reps: <input type="number" name="${ex}_${dayIdx}_reps" min="1" value="1"/>
            </div>`
          );
        });
        panel.appendChild(listDiv);
        container.appendChild(panel);
      });
    }

    function toggleConfig(id, cb){
      document.getElementById(id).style.display = cb.checked ? 'block' : 'none';
    }

    document.querySelectorAll('input[name="mode"]').forEach(rb => rb.addEventListener('change', applyMode));
    document.getElementById('saveBtn').addEventListener('click', () => {
      const schedule = { byDay: {}, config: {} };
      days.forEach((day, i) => {
        const dayInputs = Array.from(document.querySelectorAll(`input[name="day_${i}"]:checked`));
        if(dayInputs.length){
          const sel = dayInputs.map(el => el.value);
          schedule.byDay[i] = sel;
          sel.forEach(ex => {
            const sets = document.querySelector(`input[name="${ex}_${i}_sets"]`).value;
            const reps = document.querySelector(`input[name="${ex}_${i}_reps"]`).value;
            schedule.config[`${ex}_${i}`] = { sets: Number(sets), reps: Number(reps) };
          });
        }
      });
      localStorage.setItem('workoutSchedule', JSON.stringify(schedule));
      alert('Schedule saved');
    });

    window.onload = () => {
      renderWeekdayList();
      applyMode();
    };
  </script>
</body>
</html>
