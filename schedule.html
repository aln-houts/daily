<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Schedule</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; margin: 0; padding: 1rem; }
    .collapsible { max-width: 600px; margin: 1rem auto; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .collapsible header { background: #007bff; color: #fff; padding: 0.75rem 1rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
    .collapsible .content { display: none; padding: 1rem; }
    .collapsible.open .content { display: block; }
    .mode-select, .generic-panels, .weekday-list, #weekdayPanels { max-width: 600px; margin: auto; }
    .mode-select { text-align: center; padding: 1rem; }
    .weekday-list { display: flex; justify-content: space-between; flex-wrap: wrap; padding: 0.5rem 0; }
    .weekday-list label, .generic-panels label { width: 30%; display: block; margin: 0.25rem 0; }
    .day-panel { background: #eef2f5; margin: 1rem auto; padding: 1rem; border-radius: 8px; max-width: 600px; }
    .exercise-config { margin-left: 1rem; display: none; margin-bottom: 0.5rem; }
    button { padding: 0.75rem 1.5rem; margin: 1rem; background: #007bff; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0056b3; }
    input[type="number"], select { margin-left: 0.5rem; margin-top: 0.25rem; }
  </style>
</head>
<body>

  <!-- Exercise Library -->
  <section class="collapsible" id="librarySection">
    <header onclick="toggleSection('librarySection')">
      <h2>Manage Your Exercises</h2><span>+</span>
    </header>
    <div class="content">
      <div><h3>Bodyweight</h3><div id="lib-bodyweight"></div></div>
      <div><h3>Cardio</h3><div id="lib-cardio"></div></div>
      <div><h3>Dumbbell</h3><div id="lib-dumbbell"></div></div>
      <div><h3>Kettlebell</h3><div id="lib-kettlebell"></div></div>
      <div><h3>Barbell</h3><div id="lib-barbell"></div></div>
      <div><h3>Custom</h3><div id="lib-custom"></div></div>
      <div id="customAdd">
        <input id="newExerciseName" placeholder="Add custom exercise"/>
        <button onclick="addCustomExercise()">Add</button>
      </div>
    </div>
  </section>

  <!-- Mode Selector -->
  <section class="mode-select">
    <h2>Pick Schedule Mode</h2>
    <label><input type="radio" name="mode" value="daily" checked/> Daily</label>
    <label><input type="radio" name="mode" value="two-day"/> Two-Day Split</label>
    <label><input type="radio" name="mode" value="manual"/> Manual</label>
  </section>

  <!-- Generic Panels -->
  <section class="generic-panels" id="genericPanels"></section>

  <!-- Manual Weekday Selection -->
  <section class="weekday-list" id="weekdayList"></section>
  <div id="weekdayPanels"></div>

  <div style="text-align:center;"><button id="saveBtn">Save Schedule</button></div>

  <script>
    const defaultsByCategory = {
      bodyweight: ["pushups","pullups","squats","toeToBar"],
      cardio: ["running","jumpRope","burpees"],
      dumbbell: ["dumbbellRow","dumbbellPress"],
      kettlebell: ["kettlebellSwing","gobletSquat"],
      barbell: ["barbellSquat","deadlift","benchPress"]
    };
    let masterExercises = JSON.parse(localStorage.getItem('masterExercises')||'[]');
    if(!masterExercises.length) masterExercises = defaultsByCategory.bodyweight.slice();
    const days = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'];

    function capitalize(s){return s.charAt(0).toUpperCase()+s.slice(1);}

    function toggleSection(id){
      const sec=document.getElementById(id);
      const open=sec.classList.toggle('open');
      sec.querySelector('span').textContent=open?'-':'+';
    }

    function renderLibrary(){
      const flatDefaults = Object.values(defaultsByCategory).flat();
      Object.entries(defaultsByCategory).forEach(([cat,list])=>{
        const cont=document.getElementById('lib-'+cat);
        cont.innerHTML='';
        list.forEach(ex=>{
          cont.insertAdjacentHTML('beforeend',
            `<label><input type="checkbox" name="masterEx" value="${ex}" ${masterExercises.includes(ex)?'checked':''}/> ${capitalize(ex)}</label>`
          );
        });
      });
      const customCont=document.getElementById('lib-custom');
      customCont.innerHTML='';
      masterExercises.filter(ex=>!flatDefaults.includes(ex)).forEach(ex=>{
        customCont.insertAdjacentHTML('beforeend',
          `<label><input type="checkbox" name="masterEx" value="${ex}" checked/> ${capitalize(ex)}</label>`
        );
      });
      document.querySelectorAll('input[name="masterEx"]').forEach(cb=>{
        cb.onchange=()=>{
          masterExercises = Array.from(document.querySelectorAll('input[name="masterEx"]:checked')).map(i=>i.value);
          localStorage.setItem('masterExercises',JSON.stringify(masterExercises));
          renderLibrary(); applyMode();
        };
      });
    }

    function addCustomExercise(){
      const name=document.getElementById('newExerciseName').value.trim();
      if(!name) return;
      const id=name.replace(/\s+/g,'').toLowerCase();
      if(!masterExercises.includes(id)){
        masterExercises.push(id);
        localStorage.setItem('masterExercises',JSON.stringify(masterExercises));
      }
      document.getElementById('newExerciseName').value='';
      renderLibrary(); applyMode();
    }

    function renderGenericPanels(){
      const mode=document.querySelector('input[name="mode"]:checked').value;
      const container=document.getElementById('genericPanels');
      container.innerHTML='';
      if(mode==='daily'||mode==='two-day'){
        const count = mode==='daily'?1:2;
        for(let i=0;i<count;i++){
          const panel=document.createElement('div');
          panel.className='day-panel';
          panel.id='genPanel_'+i;
          panel.innerHTML=`<h3>${mode==='daily'?'Workout':'Workout Day '+(i+1)}</h3>`;
          const listDiv=document.createElement('div');
          masterExercises.forEach(ex=>{
            const exId='gen_'+i+'_'+ex;
            const isBW = defaultsByCategory.bodyweight.includes(ex);
            listDiv.insertAdjacentHTML('beforeend',
              `<label><input type="checkbox" name="gen_${i}" value="${ex}" onchange="toggleConfig('${exId}',this)"/> ${capitalize(ex)}</label>
               <div id="${exId}" class="exercise-config">
                 Sets:<input type="number" name="${ex}_${i}_sets" min="1" value="3"/>
                 Reps:<input type="number" name="${ex}_${i}_reps" min="1" value="1"/>
                 ${isBW ?
                   `Band:<select name="${ex}_${i}_band">
                      <option value="none">No band</option>
                      <option value="Light">Light</option>
                      <option value="Medium">Medium</option>
                      <option value="Heavy">Heavy</option>
                      <option value="X-Heavy">X-Heavy</option>
                    </select>
                    <select name="${ex}_${i}_bandType">
                      <option value="Assistance">Assistance</option>
                      <option value="Resistance">Resistance</option>
                    </select>` :
                   `Weight:<input type="number" name="${ex}_${i}_weight" min="0" value="0"/>`
                 }
               </div>`
            );
          });
          panel.appendChild(listDiv); container.appendChild(panel);
        }
      }
    }

    function renderWeekdayList(){
      const wl=document.getElementById('weekdayList');
      wl.innerHTML='';
      days.forEach((day,i)=>{
        wl.insertAdjacentHTML('beforeend',
          `<label><input type="checkbox" name="weekday" value="${i}"/> ${capitalize(day)}</label>`
        );
      });
      document.querySelectorAll('input[name="weekday"]').forEach(cb=>cb.addEventListener('change',buildWeekdayPanels));
    }

    function buildWeekdayPanels(){
      const cont=document.getElementById('weekdayPanels');
      cont.innerHTML='';
      document.querySelectorAll('input[name="weekday"]:checked').forEach(cb=>{
        const dayIdx=cb.value;
        const panel=document.createElement('div');
        panel.className='day-panel';
        panel.innerHTML=`<h3>${capitalize(days[dayIdx])}</h3>`;
        const listDiv=document.createElement('div');
        masterExercises.forEach(ex=>{
          const exId=`${ex}_${dayIdx}`;
          const isBW = defaultsByCategory.bodyweight.includes(ex);
          listDiv.insertAdjacentHTML('beforeend',
            `<label><input type="checkbox" name="day_${dayIdx}" value="${ex}" onchange="toggleConfig('${exId}',this)"/> ${capitalize(ex)}</label>
             <div id="${exId}" class="exercise-config">
               Sets:<input type="number" name="${ex}_${dayIdx}_sets" min="1" value="3"/>
               Reps:<input type="number" name="${ex}_${dayIdx}_reps" min="1" value="1"/>
               ${isBW ?
                 `Band:<select name="${ex}_${dayIdx}_band">
                    <option value="none">No band</option>
                    <option value="Light">Light</option>
                    <option value="Medium">Medium</option>
                    <option value="Heavy">Heavy</option>
                    <option value="X-Heavy">X-Heavy</option>
                  </select>
                  <select name="${ex}_${dayIdx}_bandType">
                    <option value="Assistance">Assistance</option>
                    <option value="Resistance">Resistance</option>
                  </select>` :
                 `Weight:<input type="number" name="${ex}_${dayIdx}_weight" min="0" value="0"/>`
               }
             </div>`
          );
        });
        panel.appendChild(listDiv); cont.appendChild(panel);
      });
    }

    function toggleConfig(id,cb){
      document.getElementById(id).style.display=cb.checked?'block':'none';
    }

    function applyMode(){
      renderLibrary(); renderGenericPanels();
      const mode=document.querySelector('input[name="mode"]:checked').value;
      document.getElementById('genericPanels').style.display=(mode==='manual')?'none':'block';
      document.getElementById('weekdayList').style.display=(mode==='manual')?'flex':'none';
      document.getElementById('weekdayPanels').style.display=(mode==='manual')?'block':'none';
      if(mode==='manual'){ renderWeekdayList(); buildWeekdayPanels(); }
    }

    document.querySelectorAll('input[name="mode"]').forEach(rb=>rb.addEventListener('change',applyMode));
    document.getElementById('saveBtn').addEventListener('click',()=>{
      const mode=document.querySelector('input[name="mode"]:checked').value;
      const schedule={byDay:{},config:{}};
      if(mode==='daily'){
        const sel=Array.from(document.querySelectorAll('input[name="gen_0"]:checked')).map(i=>i.value);
        days.forEach((_,i)=>schedule.byDay[i]=sel);
        sel.forEach(ex=>{
          const sets=document.querySelector(`input[name="${ex}_0_sets"]`).value;
          const reps=document.querySelector(`input[name="${ex}_0_reps"]`).value;
          const isBW = defaultsByCategory.bodyweight.includes(ex);
          let band=null,bandType=null,weight=null;
          if(isBW){
            band=document.querySelector(`select[name="${ex}_0_band"]`).value;
            bandType=document.querySelector(`select[name="${ex}_0_bandType"]`).value;
          } else {
            weight=Number(document.querySelector(`input[name="${ex}_0_weight"]`).value);
          }
          days.forEach((_,d)=>schedule.config[`${ex}_${d}`]={sets:Number(sets),reps:Number(reps),...(isBW?{band,bandType}:{weight})});
        });
      } else if(mode==='two-day'){
        const sel0=Array.from(document.querySelectorAll('input[name="gen_0"]:checked')).map(i=>i.value);
        const sel1=Array.from(document.querySelectorAll('input[name="gen_1"]:checked')).map(i=>i.value);
        days.forEach((_,i)=>schedule.byDay[i]=(i%2===0?sel0:sel1));
        sel0.forEach(ex=>{
          const sets=document.querySelector(`input[name="${ex}_0_sets"]`).value;
          const reps=document.querySelector(`input[name="${ex}_0_reps"]`).value;
          const isBW = defaultsByCategory.bodyweight.includes(ex);
          let band=null,bandType=null,weight=null;
          if(isBW){
            band=document.querySelector(`select[name="${ex}_0_band"]`).value;
            bandType=document.querySelector(`select[name="${ex}_0_bandType"]`).value;
          } else {
            weight=Number(document.querySelector(`input[name="${ex}_0_weight"]`).value);
          }
          days.forEach((_,d)=>{ if(d%2===0) schedule.config[`${ex}_${d}`]={sets:Number(sets),reps:Number(reps),...(isBW?{band,bandType}:{weight})}; });
        });
        sel1.forEach(ex=>{
          const sets=document.querySelector(`input[name="${ex}_1_sets"]`).value;
          const reps=document.querySelector(`input[name="${ex}_1_reps"]`).value;
          const isBW = defaultsByCategory.bodyweight.includes(ex);
          let band=null,bandType=null,weight=null;
          if(isBW){
            band=document.querySelector(`select[name="${ex}_1_band"]`).value;
            bandType=document.querySelector(`select[name="${ex}_1_bandType"]`).value;
          } else {
            weight=Number(document.querySelector(`input[name="${ex}_1_weight"]`).value);
          }
          days.forEach((_,d)=>{ if(d%2===1) schedule.config[`${ex}_${d}`]={sets:Number(sets),reps:Number(reps),...(isBW?{band,bandType}:{weight})}; });
        });
      } else {
        days.forEach((_,i)=>{
          const sel=Array.from(document.querySelectorAll(`input[name="day_${i}"]:checked`)).map(i=>i.value);
          if(sel.length) schedule.byDay[i]=sel;
          sel.forEach(ex=>{
            const sets=document.querySelector(`input[name="${ex}_${i}_sets"]`).value;
            const reps=document.querySelector(`input[name="${ex}_${i}_reps"]`).value;
            const isBW = defaultsByCategory.bodyweight.includes(ex);
            let band=null,bandType=null,weight=null;
            if(isBW){
              band=document.querySelector(`select[name="${ex}_${i}_band"]`).value;
              bandType=document.querySelector(`select[name="${ex}_${i}_bandType"]`).value;
            } else {
              weight=Number(document.querySelector(`input[name="${ex}_${i}_weight"]`).value);
            }
            schedule.config[`${ex}_${i}`]={sets:Number(sets),reps:Number(reps),...(isBW?{band,bandType}:{weight})};
          });
        });
      }
      localStorage.setItem('masterExercises',JSON.stringify(masterExercises));
      localStorage.setItem('workoutSchedule',JSON.stringify(schedule));
      alert('Schedule saved');
      window.location.href='index.html';
    });

    window.onload=applyMode;
  </script>
</body>
</html>
